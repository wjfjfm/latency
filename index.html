<html>
<head>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css"/>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/searchbuilder/1.3.2/css/searchBuilder.dataTables.min.css"/>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/datetime/1.1.2/css/dataTables.dateTime.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/searchbuilder/1.3.2/js/dataTables.searchBuilder.min.js"> </script>
    <script type="text/javascript" src="https://cdn.datatables.net/datetime/1.1.2/js/dataTables.dateTime.min.js"> </script>
    <script type="text/javascript" src="./utils.js"> </script>
<style>
    .rowBackground{
        background-color: rgb(226, 229, 229);
    }
</style>
</head>

<body>

<table id="time-use" class="display" width="100%">
    <thead>
        <tr>
            <th>operation</th>
            <th>time use(ns)</th>
            <th>time use(us)</th>
            <th>time use(ms)</th>
            <th>if 1ns = 1s then ...</th>
            <th>note</th>
            <th>date</th>
            <th>tags</th>
        </tr>
    </thead>
</table>

<script type="text/javascript">

var searchBuilderPredefine = {
    criteria: [
        {
            data: 'date',
            condition: '>',
            value: ['2000-1-1']
        },
        {
            criteria: [
                {
                    data: 'tags',
                    condition: 'contains',
                    value: ['default']

                },
                {
                    data: 'tags',
                    condition: 'contains',
                    value: ['light']

                },
                {
                    data: 'tags',
                    condition: 'contains',
                    value: ['CPU']

                },
                {
                    data: 'tags',
                    condition: 'contains',
                    value: ['language']

                },
                {
                    data: 'operation',
                    condition: 'contains',
                    value: ['Linux']
                }

            ],
            logic: 'OR'
        }

    ],
    logic: 'AND'
};


$(document).ready(function() {
    var table = $('#time-use').DataTable({
        processing: true,
        ajax: {
            url: 'data/data.json'
        },
        columns: [
            { "data": "operation" },
            { 
                "data": "time"
            },
            { 
                "data": function( row, type, val, meta){
                    var us = Math.floor(row.time / 1000);
                    if (us > 0) return us;
                    return null;
                } 
            },
            { 
                "data": function( row, type, val, meta){
                    var us = Math.floor(row.time / 1000000);
                    if (us > 0) return us;
                    return null;
                } 
            },
            { 
                "data": function( row, type, val, meta){
                    var time = forHumans(row.time);
                    console.log(time);
                    return time;
                } 
            },
            { "data": "note" },
            {
                "data": "date",
                "visible": false
            },
            { 
                "data": "tags",
                "visible": false
             },
        ],
        order: [[1, "asc"]],
        searchBuilder:{
            preDefined: searchBuilderPredefine
        },
        dom: 'Qlfrtip',
        lengthMenu : [[-1, 10, 25, 50, 100], ["All", 10, 25, 50, 100]],
    });
    

     table.rows().every( function () {
         this.hasChild = false;
     } );
     
     $('#time-use tbody').on( 'click', 'tr', function () {
         var this_row = table.row(this);
         var data = this_row.data();
         if (!this_row.hasChild) {
             this_row.child([
                 "Record Date: " + data.date,
                 "Record tags: " + data.tags,
                 "More detail: ",
                 data.detail,
            ], 'rowBackground');
             this_row.hasChild = true;
         }
         var child = table.row( this ).child;
     
         if ( child.isShown() ) {
             child.hide();
         }
         else {
             child.show();
         }
     } );

} );
</script>

</body>
</html>

